function initializeNavigation(){const loadHTML=(url,placeholderId,callback)=>{fetch(url).then(response=>{if(!response.ok)throw new Error(`Failed to load ${url}`);return response.text()}).then(data=>{const placeholder=document.getElementById(placeholderId);placeholder&&(placeholder.innerHTML=data,callback&&callback())}).catch(error=>console.error(`Error loading content for ${placeholderId}:`,error))};loadHTML("/nav.html","navbar-placeholder",()=>{initializeSearch(),initializeResponsiveCategories(),window.initializeAuth&&window.initializeAuth()});loadHTML("/footer.html","footer-placeholder",()=>{"undefined"!=typeof firebase&&firebase.apps.length&&loadFooterCategories()})}function initializeSearch(){const searchToggleBtn=document.getElementById("search-toggle-btn"),searchForm=document.getElementById("nav-search-form"),searchInput=document.getElementById("nav-search-input");searchToggleBtn&&searchForm&&searchInput?(searchToggleBtn.addEventListener("click",e=>{e.preventDefault(),searchForm.classList.toggle("active"),searchForm.classList.contains("active")&&searchInput.focus()}),document.addEventListener("click",e=>{const nav=document.querySelector(".navbar");nav&&!nav.contains(e.target)&&searchForm.classList.remove("active")}),searchForm.addEventListener("submit",e=>{e.preventDefault();const query=searchInput.value.trim();query&&("/stock-data.html"===window.location.pathname&&"function"==typeof searchStock?(searchInput.value=query.toUpperCase(),searchForm.classList.remove("active"),searchStock()):window.location.href=`/search.html?q=${encodeURIComponent(query)}`)}),searchInput.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),searchForm.dispatchEvent(new Event("submit")))})):console.warn("Search elements not found.")}function initializeResponsiveCategories(){const DEFAULT_CATEGORIES=[{name:"AI",slug:"ai",order:1},{name:"Gadgets",slug:"gadgets",order:2},{name:"Startups",slug:"startups",order:3},{name:"Crypto",slug:"crypto",order:4}],renderCategories=categories=>{const navbarNav=document.querySelector("#navbarMain .navbar-nav"),moreDropdownMenu=document.getElementById("more-dropdown-menu"),moreDropdown=document.getElementById("more-dropdown");if(!navbarNav)return void console.error("Navbar nav element not found");navbarNav.querySelectorAll('[data-category="true"]').forEach(el=>el.remove());const maxVisibleCategories=window.innerWidth>=992?5:3,visibleCategories=categories.slice(0,maxVisibleCategories),hiddenCategories=categories.slice(maxVisibleCategories),insertBeforeElement=moreDropdown||navbarNav.querySelector('.nav-item:not([data-category="true"])');if(visibleCategories.forEach(cat=>{const li=document.createElement("li");li.className="nav-item",li.setAttribute("data-category","true");const a=document.createElement("a");a.className="nav-link",a.href=`/${cat.slug}`,a.textContent=translateCategory(cat.name),li.appendChild(a),insertBeforeElement?navbarNav.insertBefore(li,insertBeforeElement):navbarNav.appendChild(li)}),moreDropdownMenu&&moreDropdown){moreDropdownMenu.innerHTML="",hiddenCategories.forEach(cat=>{const li=document.createElement("li"),a=document.createElement("a");a.className="dropdown-item",a.href=`/${cat.slug}`,a.textContent=translateCategory(cat.name),li.appendChild(a),moreDropdownMenu.appendChild(li)});const podcastsLi=document.createElement("li"),podcastsLink=document.createElement("a");podcastsLink.className="dropdown-item",podcastsLink.href="/podcasts.html",podcastsLink.innerHTML='<i class="bi bi-mic me-1"></i>Podcasts',podcastsLi.appendChild(podcastsLink),moreDropdownMenu.appendChild(podcastsLi);const stocksLi=document.createElement("li"),stocksLink=document.createElement("a");stocksLink.className="dropdown-item",stocksLink.href="/stock-data.html",stocksLink.innerHTML='<i class="bi bi-graph-up me-1"></i>Stocks',stocksLi.appendChild(stocksLink),moreDropdownMenu.appendChild(stocksLi),moreDropdownMenu.children.length>0?moreDropdown.classList.remove("d-none"):moreDropdown.classList.add("d-none")}if(!navbarNav.querySelector('a[href="/stock-data.html"]')){const stockLi=document.createElement("li");stockLi.className="nav-item",stockLi.setAttribute("data-category","true");const stockLink=document.createElement("a");stockLink.className="nav-link",stockLink.href="/stock-data.html",stockLink.innerHTML='<i class="bi bi-graph-up me-1"></i>Stocks',stockLi.appendChild(stockLink),moreDropdown?navbarNav.insertBefore(stockLi,moreDropdown):insertBeforeElement?navbarNav.insertBefore(stockLi,insertBeforeElement):navbarNav.appendChild(stockLi)}};(async()=>{if(!await new Promise(resolve=>{let attempts=0;const interval=setInterval(()=>{"undefined"!=typeof firebase&&firebase.apps.length?(clearInterval(interval),resolve(!0)):++attempts>=30&&(clearInterval(interval),resolve(!1))},100)}))return console.warn("Firebase not initialized yet for categories; using defaults"),DEFAULT_CATEGORIES;try{const db=firebase.firestore();let snapshot=await db.collection("categories").orderBy("order","asc").get();if(snapshot.empty&&(console.log("No documents in 'categories' collection, trying 'sections'"),snapshot=await db.collection("sections").orderBy("order","asc").get()),snapshot.empty)return console.warn("No categories found in either 'categories' or 'sections' collections"),DEFAULT_CATEGORIES;const categories=[];return snapshot.forEach(doc=>{const data=doc.data();categories.push({id:doc.id,name:data.name,slug:data.slug||data.name.toLowerCase().replace(/\s+/g,"-"),order:data.order||999})}),console.log("Categories loaded:",categories),categories}catch(error){return console.error("Error fetching categories from Firebase:",error),DEFAULT_CATEGORIES}})().then(categories=>{let resizeTimeout;renderCategories(categories),window.addEventListener("resize",()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{const navbarNav=document.querySelector("#navbarMain .navbar-nav");navbarNav&&(navbarNav.querySelectorAll('[data-category="true"]').forEach(el=>el.remove()),renderCategories(categories))},150)})})}function loadFooterCategories(){const footerCategoriesList=document.getElementById("footer-categories-list");if(!footerCategoriesList||"undefined"==typeof firebase)return;const db=firebase.firestore();db.collection("categories").orderBy("order","asc").get().then(snapshot=>snapshot.empty?db.collection("sections").orderBy("order","asc").get():snapshot).then(snapshot=>{if(snapshot.empty)footerCategoriesList.innerHTML=`\n          <li><a href="/ai">${translateCategory("AI")}</a></li>\n          <li><a href="/gadgets">${translateCategory("Gadgets")}</a></li>\n          <li><a href="/startups">${translateCategory("Startups")}</a></li>\n          <li><a href="/crypto">${translateCategory("Crypto")}</a></li>\n        `;else{let categoriesHTML="";snapshot.forEach(doc=>{const category=doc.data(),slug=category.slug||category.name.toLowerCase().replace(/\s+/g,"-");categoriesHTML+=`<li><a href="${`/${slug}`}">${translateCategory(category.name)}</a></li>`}),footerCategoriesList.innerHTML=categoriesHTML}}).catch(error=>{console.error("Error loading footer categories:",error),footerCategoriesList.innerHTML='<li class="text-muted">Unable to load categories</li>'})}document.addEventListener("firebase-ready",()=>{navigationInitialized||(navigationInitialized=!0,initializeNavigation())});let firebaseReadyFired=!1,navigationInitialized=!1;document.addEventListener("firebase-ready",()=>{firebaseReadyFired=!0,console.log("Firebase ready event fired")}),document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{!navigationInitialized&&!firebaseReadyFired&&"undefined"!=typeof firebase&&firebase.apps&&firebase.apps.length>0&&(console.log("Fallback: Initializing navigation without firebase-ready event"),navigationInitialized=!0,initializeNavigation())},1e3),!navigationInitialized&&"undefined"!=typeof firebase&&firebase.apps&&firebase.apps.length>0&&(console.log("Firebase already initialized, loading navigation immediately"),navigationInitialized=!0,initializeNavigation())}),window.initializeNavigation=initializeNavigation;
