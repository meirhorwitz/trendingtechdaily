<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile - TrendingTech Daily</title>

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-M68CNVMQ');</script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Sans:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css"> <link rel="stylesheet" href="css/signup-styles.css"> <link rel="stylesheet" href="css/profile-styles.css"> <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M68CNVMQ"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="navbar-placeholder">
        </div>

    <div class="auth-page-container profile-page-container">
        <main class="container mt-4 mb-5">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-xl-8">
                    <h1 class="mb-4 profile-main-title">My Profile</h1>

                    <div id="profile-loading" class="text-center p-5">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="text-muted mt-2">Loading profile...</p>
                    </div>

                    <div id="profile-content" style="display: none;">
                        <div class="card shadow-sm mb-4 profile-card profile-header-card">
                            <div class="card-body">
                                <div class="d-flex flex-column flex-sm-row align-items-center">
                                    <div class="position-relative mb-3 mb-sm-0 me-sm-3 profile-pic-wrapper">
                                        <img id="profile-pic" src="/img/default-avatar.png" alt="Profile Picture" class="rounded-circle profile-avatar">
                                        <button type="button" id="change-profile-pic-btn" class="btn btn-sm btn-light position-absolute bottom-0 end-0 rounded-circle profile-pic-edit-btn" title="Change Picture" data-bs-toggle="modal" data-bs-target="#profilePicModal">
                                            <i class="bi bi-camera-fill"></i>
                                        </button>
                                    </div>
                                    <div class="flex-grow-1 text-center text-sm-start">
                                        <div class="d-flex align-items-center justify-content-center justify-content-sm-start">
                                            <h3 id="profile-display-name" class="mb-0 profile-user-name">Loading...</h3>
                                            <button type="button" class="btn btn-sm text-primary ms-2 p-0 edit-icon-btn" title="Edit Display Name" data-bs-toggle="modal" data-bs-target="#displayNameModal">
                                                <i class="bi bi-pencil-square"></i>
                                            </button>
                                        </div>
                                        <p id="profile-email" class="text-muted mb-0 profile-user-email">Loading...</p>
                                        <p id="profile-joined" class="text-muted small mb-0 profile-user-joined">Joined: Loading...</p>
                                    </div>
                                </div>
                                <hr class="my-3">
                                <div class="d-flex align-items-start mt-3">
                                    <div id="bio-container" class="flex-grow-1 profile-bio-text">
                                        <p id="profile-bio" class="mb-0">Loading bio...</p>
                                    </div>
                                    <button type="button" class="btn btn-sm text-primary ms-2 p-0 edit-icon-btn" title="Edit Bio" data-bs-toggle="modal" data-bs-target="#bioModal">
                                        <i class="bi bi-pencil-square"></i>
                                    </button>
                                </div>
                                <button id="profile-logout-btn" class="btn btn-sm btn-outline-danger mt-4">Logout</button>
                            </div>
                        </div>

                        <div class="card shadow-sm mb-4 profile-card">
                            <div class="card-header profile-card-header">Saved Articles</div>
                            <div class="card-body">
                                <div id="saved-articles-list" class="profile-activity-list">Loading saved articles...</div>
                            </div>
                        </div>

                        <div class="card shadow-sm mb-4 profile-card">
                            <div class="card-header profile-card-header">Recently Read</div>
                            <div class="card-body">
                                <div id="read-history-list" class="profile-activity-list">Loading read history...</div>
                            </div>
                        </div>

                        <div class="card shadow-sm mb-4 profile-card">
                            <div class="card-header profile-card-header">My Comments</div>
                            <div class="card-body">
                                <div id="my-comments-list" class="profile-activity-list">Loading comments...</div>
                            </div>
                        </div>

                        <div class="card shadow-sm mb-4 profile-card">
                            <div class="card-header profile-card-header d-flex justify-content-between align-items-center">
                                <span>Stock Watchlist</span>
                                <a href="/stock-data.html" class="btn btn-sm btn-outline-primary">View Market Data</a>
                            </div>
                            <div class="card-body">
                                <div id="stock-watchlist-loading" class="text-center py-3" style="display: none;">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                                    <span class="text-muted ms-2">Loading watchlist...</span>
                                </div>
                                <div id="stock-watchlist-content" class="profile-activity-list"></div>
                            </div>
                        </div>
                    </div>

                    <div id="profile-error" class="alert alert-danger mt-4" style="display: none;"></div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal fade" id="profilePicModal" tabindex="-1" aria-labelledby="profilePicModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content auth-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profilePicModalLabel">Change Profile Picture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profile-pic-form">
                        <div class="mb-3">
                            <label for="profile-pic-upload" class="form-label">Select new picture (max 5MB, JPG/PNG)</label>
                            <input class="form-control" type="file" id="profile-pic-upload" accept="image/jpeg, image/png, image/gif">
                        </div>
                        <div id="profile-pic-preview-container" class="mb-3 text-center" style="display: none;">
                            <img id="profile-pic-preview" src="#" alt="Preview" class="rounded-circle" style="width: 120px; height: 120px; object-fit: cover; border: 2px solid #eee;">
                        </div>
                        <div id="profile-pic-feedback" class="form-message"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="save-profile-pic-btn" class="btn btn-primary auth-submit-btn">
                        <span id="profile-pic-spinner" class="spinner-border spinner-border-sm d-none me-1" role="status"></span>
                        Save Picture
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="displayNameModal" tabindex="-1" aria-labelledby="displayNameModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content auth-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="displayNameModalLabel">Edit Display Name</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="display-name-form">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="edit-display-name" placeholder="Your Name" required maxlength="50">
                            <label for="edit-display-name">Display Name</label>
                        </div>
                        <div id="display-name-feedback" class="form-message"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="save-display-name-btn" class="btn btn-primary auth-submit-btn">
                        <span id="display-name-spinner" class="spinner-border spinner-border-sm d-none me-1" role="status"></span>
                        Save Name
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="bioModal" tabindex="-1" aria-labelledby="bioModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content auth-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bioModalLabel">Edit Bio</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="bio-form">
                        <div class="form-floating mb-3">
                            <textarea class="form-control" id="edit-bio" placeholder="Tell us about yourself (max 250 characters)" style="height: 150px" maxlength="250"></textarea>
                            <label for="edit-bio">Bio (Optional)</label>
                        </div>
                        <div id="bio-feedback" class="form-message"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="save-bio-btn" class="btn btn-primary auth-submit-btn">
                        <span id="bio-spinner" class="spinner-border spinner-border-sm d-none me-1" role="status"></span>
                        Save Bio
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="footer-placeholder">
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/app-base.js"></script>
    <script src="/js/profile.js"></script>
    <script src="/js/nav-loader.js"></script>
</body>
</html>
